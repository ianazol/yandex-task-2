## Тестовое задание №2 в ШРИ Яндекс

Для решения задачи реализован веб-сервер на Node.js с использованием фреймворка express.js.   
Хранение данных обеспечивает база данных MongoDB.   
**Библиотека для работы с расписанием представляет собой модуль на сервере (`/server/lib/yamblz`).**   
Ключевые части библиотеки покрыты тестами.   
Веб-интерфейс на React  

### Структура проекта

`/client/` - клиентская часть приложения   
`/client/css/` - стили   
`/client/js/build/` - собранные скрипты   
`/client/js/src/` - шаблоны для компиляции и скрипты   
`/client/*.html` - статические странички веб-интерфейса   
`/server/` - серверная часть приложения   
`/server/controllers/` - контроллеры, принимают объект request -> выполняют действия -> отправляют объект response   
`/server/models/` - схемы БД   
`/server/routes/` - роуты, которые обрабатывает сервер   
`/server/app.js` - точка входа   
`/server/database.js` - подключение к БД, в тестовом окружении подключается тестовая база данных   
`/test/` - тесты к библиотеке yamblz   

### Установка и запуск
Выполнить команды
```
npm install
npm start
```

и затем открыть в браузере `http://localhost:3000`

запуск тестов
```
npm test
```

### Описание библиотеки

Для обеспечения корректности и связанности даных библиотека осуществляет следующие проверки:   

**Аудитория** (`/server/lib/yamblz/classroom`)

Перед созданием:
- переданы все обязательные параметры   
- вместимость аудитории является целым числом

Перед изменением:   
- вместимость аудитории является целым числом
- вместимость аудитории не будет меньше количества всех студентов на всех запланированных лекциях в этой аудитории.   

Перед удалением:   
- нет лекций в этой аудитории   

**Школа** (`/server/lib/yamblz/school`)
 
Перед созданием:    
- переданы все обязательные параметры   
- количество студентов является целым числом

Перед изменением:   
- количество студентов является целым числом   
- количество студентов не будет больше вместимости аудитории на всех запланированных лекциях для этой школы.

Перед удалением:   
- нет лекций для этой школы   

**Лекция** (`/server/lib/yamblz/lecture`)

Перед созданием:   
- переданы все обязательные параметры   
- дата начала лекции не позже даты окончания   
- вместимость аудитории не меньше количества студентов школ   
- в аудитории нет другой лекции в указанный период   
- у школы нет другой лекции в указанный период

Перед изменением:   
- дата начала лекции не позже даты окончания   
- вместимость аудитории не меньше количества студентов школ   
- в аудитории нет другой лекции в указанный период   
- у школы нет другой лекции в указанный период   

### Пример использования
```javascript
const yamblz = require("../lib/yamblz");

// создать аудиторию
let classroomData = {name: "Красная аудитория", capacity: 100, description: "Классная аудитория на втором этаже"};
yamblz.classroom.add(classroomData)
     .then((classroom) => {
          // что-то делаем с новой аудиторией
     })
     .catch((error) => console.log(error.message));
     
// получить график лекций в аудитории в определенный период
let query = {from: "2017-07-03", to: "2017-07-06", classroom: "classroomId"};
yamblz.lecture.getList(query)
     .then((lectures) => {
          // что-то делаем с массивом лекций
     })
     .catch((error) => console.log(error.message));
```

### Справочник по API
**Аудитория**

`yamblz.classroom.add(obj);`

Добавляет аудиторию   
Возвращает Promise (resolved - объект с данными новой аудитории, rejected - объект ошибки)   

Параметры:   
obj (Тип: Object)   
В таблице описаны свойства объекта obj   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| name  | Название аудитории  | String  | Да  |
| capacity  | Вместимость аудитории  | Number  | Да  |
| description  | Описание  | String  | Да  |

-------------------------------------
`yamblz.classroom.update(id, [obj]);`

Изменяет аудиторию   
Возвращает Promise (resolved - объект с данными измененной аудитории, rejected - объект ошибки)   

Параметры:   
id (Тип: String)   
obj (Тип: Object)   
В таблице описаны свойства объекта obj   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| name  | Название аудитории  | String  | Нет  |
| capacity  | Вместимость аудитории  | Number  | Нет  |
| description  | Описание  | String  | Нет  |

-------------------------------------
`yamblz.classroom.remove(id);`

Удаляет аудиторию   
Возвращает Promise (resolved - объект с количеством успешно удаленных записей, rejected - объект ошибки)   

Параметры:   
id (Тип: String)   

-------------------------------------
`yamblz.classroom.getList();`

Получить список аудиторий   
Возвращает Promise (resolved - массив с объектами, rejected - объект ошибки)   

**Школа**

`yamblz.school.add(obj);`

Добавляет школу   
Возвращает Promise (resolved - объект с данными новой школы, rejected - объект ошибки)   

Параметры:   
obj (Тип: Object)   
В таблице описаны свойства объекта obj   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| name  | Название школы  | String  | Да  |
| count  | Количество студентов  | Number  | Да  |

-------------------------------------
`yamblz.school.update(id, [obj]);`

Изменяет аудиторию   
Возвращает Promise (resolved - объект с данными измененной школы, rejected - объект ошибки)   

Параметры:   
id (Тип: String)   
obj (Тип: Object)   
В таблице описаны свойства объекта obj   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| name  | Название школы  | String  | Нет  |
| count  | Количество студентов  | Number  | Нет  |

-------------------------------------
`yamblz.school.remove(id);`

Удаляет школу   
Возвращает Promise (resolved - объект с количеством успешно удаленных записей, rejected - объект ошибки)   

Параметры:   
id (Тип: String)   

-------------------------------------
`yamblz.school.getList();`

Получить список школ   
Возвращает Promise (resolved - массив с объектами, rejected - объект ошибки)   

**Лекция**

`yamblz.lecture.add(obj);`

Добавляет лекцию   
Возвращает Promise (resolved - объект с данными новой лекции, rejected - объект ошибки)   

Параметры:   
obj (Тип: Object)   
В таблице описаны свойства объекта obj   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| name  | Название лекции  | String  | Да  |
| lecturer  | Имя лектора  | String  | Да  |
| start  | Дата и время начала  | Date  | Да  |
| finish  | Дата и время окончания  | Date  | Да  |
| school  | ID школы/школ  | String/Array  | Да  |
| classroom  | ID аудитории  | String  | Да  |

-------------------------------------
`yamblz.lecture.update(id, [obj]);`

Изменяет аудиторию   
Возвращает Promise (resolved - объект с данными измененной лекции, rejected - объект ошибки)   

Параметры:   
id (Тип: String)   
obj (Тип: Object)   
В таблице описаны свойства объекта obj   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| name  | Название лекции  | String  | Нет  |
| lecturer  | Имя лектора  | String  | Нет  |
| start  | Дата и время начала  | Date  | Нет  |
| finish  | Дата и время окончания  | Date  | Нет  |
| school  | ID школы/школ  | String/Array  | Нет  |
| classroom  | ID аудитории  | String  | Нет  |
-------------------------------------
`yamblz.lecture.remove(id);`

Удаляет лекцию   
Возвращает Promise (resolved - объект с количеством успешно удаленных записей, rejected - объект ошибки)   

Параметры:   
id (Тип: String)   

-------------------------------------
`yamblz.lecture.getList([query]);`

Получить список лекций   
Возвращает Promise (resolved - массив с объектами, rejected - объект ошибки)

Параметры:   
query (Тип: Object)   
В таблице описаны свойства объекта query   

| Свойство  | Описание  | Тип | Обязательное  |
| ------------- | ------------- | ------------- | ------------- |
| from  | Дата начала  | Date  | Нет  |
| to  | Дата окончания  | Date  | Нет  |
| school  | ID школы  | String  | Нет  |
| classroom  | ID аудитории  | String  | Нет  |
 